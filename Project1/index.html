<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CS280A · Project 1 — Colorizing the Prokudin-Gorskii Collection</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --max: 860px; }
    * { box-sizing: border-box; }
    body { margin: 24px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; line-height: 1.6; background:#fafafa;}
    main, header, footer { max-width: var(--max); margin: 0 auto; }
    h1, h2, h3 { line-height: 1.25; }
    .muted { color:#666; font-size: 14px; }
    .pair { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 14px; margin:14px 0;}
    figure { margin: 0; border: 1px solid #eaeaea; border-radius: 10px; padding: 10px; background: #fff; }
    figcaption { margin-top: 6px; font-size: 14px; color: #555; }
    img { max-width: 100%; height: auto; display: block; background: #f5f5f5; border-radius: 6px; }
    .answer { border-left: 4px solid #2f6feb; background: #f0f6ff; padding: 12px 14px; border-radius: 8px; margin:12px 0;}
    .prompt { border-left: 4px solid #999; background: #f7f7f7; padding: 12px 14px; border-radius: 8px; margin:12px 0;}
    .code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    nav a { text-decoration: none; }
    hr { border: none; height: 1px; background: #eee; margin: 28px 0; }
    .toc a { color:#2f6feb; text-decoration:none; }
  </style>
</head>
<body>
  <header>
    <p class="muted"><a href="../index.html">← Back to Home</a></p>
    <h1>Project 1 — Colorizing the Prokudin-Gorskii Collection</h1>
    <p class="muted">CS280A · Wentio Li · Sept 2025</p>
  </header>

  <main>
    <!-- TOC -->
    <section class="toc">
      <p>
        <a href="#overview">1. Overview</a> ·
        <a href="#basic">2. Basic Alignment</a> ·
        <a href="#bw">3. Bells &amp; Whistles</a> ·
        <a href="#params">4. Parameters</a>
      </p>
    </section>

    <hr />

    <!-- 1. Project Overview -->
    <section id="overview">
      <h2>1. Project Overview</h2>
      <div class="prompt"> In this project, I implemented an end-to-end pipeline to reconstruct color images from the Prokudin-Gorskii glass plate negatives. Each input consists of a single grayscale image with three vertically stacked channels in the order **B–G–R**. The task is to split these channels, align them by translation, and recombine them into a single RGB output with minimal artifacts.

My pipeline starts with a **single-scale exhaustive search** for low-resolution images, where the green and red channels are shifted relative to blue within a fixed displacement window. Alignment quality is evaluated using **Normalized Cross-Correlation (NCC)** as the similarity metric. To handle large displacements in high-resolution scans, I extended this to a **coarse-to-fine pyramid search**: images are recursively downsampled, aligned at a coarse level, and progressively refined at higher resolutions.

For the CS280A requirements, I incorporated several enhancements to improve the visual quality beyond alignment. These include **automatic cropping** of inconsistent borders, **contrast stretching** to expand dynamic range, **white balance correction** using white-patch and gray-world assumptions, a **learned 3×3 color correction matrix** to better map raw channels to display RGB, and **gradient-based features** for more robust alignment across channels with brightness differences.

Together, these steps form a robust and efficient pipeline capable of producing high-quality color reconstructions for the images from the LoC Prokudin-Gorskii collection.
</div>
      <div class="pair">
        <figure><img src="./media/raw.jpg" alt="overview" /><figcaption>cathedral, raw</figcaption></figure>
      </div>
      <div class="answer">Analysis goes here.</div>
    </section>

    <hr />

    <!-- 2. Basic Alignment -->
    <section id="basic">
      <h2>2. Basic Alignment</h2>

      <!-- 2.1 Single-scale -->
      <section id="basic-single">
        <h3>2.1 Single-Scale Alignment</h3>
        <div class="prompt">Method introduction</div>
        <div class="pair">
          <figure><img src="./media/main/single/cathedral_single_ncc.jpg" alt="single1" /><figcaption>cathedral, single</figcaption></figure>
          <figure><img src="./media/main/single/monastery_single_ncc.jpg" alt="single2" /><figcaption>monastery, single</figcaption></figure>
          <figure><img src="./media/main/single/tobolsk_single_ncc.jpg" alt="single3" /><figcaption>tobolsk, single</figcaption></figure>
        </div>
        <div class="answer">Analysis of results.</div>
      </section>

      <!-- 2.2 Pyramid -->
      <section id="basic-pyramid">
        <h3>2.2 Pyramid (Multi-Stage) Alignment</h3>
        <div class="prompt">Method introduction</div>
        <div class="pair">
          <figure><img src="./media/main/cathedral_pyr_ncc.jpg" alt="cathedral pyramid" /><figcaption>cathedral, pyramid</figcaption></figure>
          <figure><img src="./media/main/monastery_pyr_ncc.jpg" alt="monastery pyramid" /><figcaption>monastery, pyramid</figcaption></figure>
          <figure><img src="./media/main/tobolsk_pyr_ncc.jpg" alt="tobolsk pyramid" /><figcaption>tobolsk, pyramid</figcaption></figure>
          <figure><img src="./media/main/church_pyr_ncc.jpg" alt="church pyramid" /><figcaption>church, pyramid</figcaption></figure>
          <figure><img src="./media/main/emir_pyr_ncc.jpg" alt="emir pyramid" /><figcaption>emir, pyramid</figcaption></figure>
          <figure><img src="./media/main/harvesters_pyr_ncc.jpg" alt="harvesters pyramid" /><figcaption>harvesters, pyramid</figcaption></figure>
          <figure><img src="./media/main/icon_pyr_ncc.jpg" alt="icon pyramid" /><figcaption>icon, pyramid</figcaption></figure>
          <figure><img src="./media/main/italil_pyr_ncc.jpg" alt="italil pyramid" /><figcaption>italil, pyramid</figcaption></figure>
          <figure><img src="./media/main/lastochikino_pyr_ncc.jpg" alt="lastochikino pyramid" /><figcaption>lastochikino, pyramid</figcaption></figure>
          <figure><img src="./media/main/lugano_pyr_ncc.jpg" alt="lugano pyramid" /><figcaption>lugano, pyramid</figcaption></figure>
          <figure><img src="./media/main/melons_pyr_ncc.jpg" alt="melons pyramid" /><figcaption>melons, pyramid</figcaption></figure>
          <figure><img src="./media/main/self_portrait_pyr_ncc.jpg" alt="self portrait pyramid" /><figcaption>self_portrait, pyramid</figcaption></figure>
          <figure><img src="./media/main/siren_pyr_ncc.jpg" alt="siren pyramid" /><figcaption>siren, pyramid</figcaption></figure>
          <figure><img src="./media/main/three_generations_pyr_ncc.jpg" alt="three generations pyramid" /><figcaption>three_generations, pyramid</figcaption></figure>
        </div>
        <div class="answer">Analysis of pyramid results.</div>
      </section>
    </section>

    <hr />

    <!-- 3. Bells & Whistles -->
    <section id="bw">
      <h2>3. Bells &amp; Whistles</h2>

      <!-- 3.1 Cropping -->
      <section id="bw-crop">
        <h3>3.1 Automatic Cropping</h3>
        <div class="prompt">Method introduction</div>
        <div class="pair">
          <figure><img src="./media/main/italil_pyr_ncc.jpg" alt="crop before" /><figcaption>italil, before.</figcaption></figure>
          <figure><img src="./media/BW/crop/italil_pyr_ncc_crop.jpg" alt="crop after" /><figcaption>italil, after.</figcaption></figure>
        </div>
        <div class="answer">Analysis of cropping results.</div>
      </section>

      <!-- 3.2 Contrast -->
      <section id="bw-contrast">
        <h3>3.2 Automatic Contrast</h3>
        <div class="prompt">Method introduction</div>
         <div class="pair">
          <figure><img src="./media/main/italil_pyr_ncc.jpg" alt="contrast before" /><figcaption>italil, before.</figcaption></figure>
          <figure><img src="./media/BW/contrast/italil_pyr_ncc_contrast.jpg" alt="contrast after" /><figcaption>italil, after.</figcaption></figure>
        </div>
        <div class="answer">Analysis of contrast results.</div>
      </section>

      <!-- 3.3 White Balance -->
      <section id="bw-wb">
        <h3>3.3 Automatic White Balance</h3>
        <div class="prompt">Method introduction</div>
        <div class="pair">
          <figure><img src="./media/main/church_pyr_ncc.jpg" alt="wb before" /><figcaption>church, before.</figcaption></figure>
          <figure><img src="./media/BW/whiteb/church_pyr_ncc_wb_shades_of_gray.jpg" alt="wb after" /><figcaption>church, after.</figcaption></figure>
        </div>
        <div class="answer">Analysis of white balance results.</div>
      </section>

      <!-- 3.4 Color Mapping -->
      <section id="bw-colormap">
        <h3>3.4 Better Color Mapping</h3>
        <div class="prompt">Method introduction</div>
        <div class="pair">
          <figure><img src="./media/main/church_pyr_ncc.jpg" alt="colormap before" /><figcaption>church, before.</figcaption></figure>
          <figure><img src="./media/BW/color/church_pyr_ncc_ccm.jpg" alt="colormap after" /><figcaption>church, after.</figcaption></figure>
        </div>
        <div class="answer">Analysis of color mapping results.</div>
      </section>

      <!-- 3.5 Better Features -->
      <section id="bw-features">
        <h3>3.5 Better Features</h3>
        <div class="prompt">Method introduction</div>
        <div class="pair">
          <figure><img src="./media/main/self_portrait_pyr_ncc.jpg" alt="raw features" /><figcaption>self_portrait, raw matching.</figcaption></figure>
          <figure><img src="./media/BW/feature/self_portrait_pyr_ncc_grad.jpg" alt="gradient features" /><figcaption>self_portrait, gradient-based matching.</figcaption></figure>
        </div>
        <div class="answer">Analysis of feature-based alignment.</div>
      </section>
    </section>

    <hr />


    <!-- 4. Parameters -->
    <section id="params">
      <h2>4. Parameters &amp; Environment</h2>
      <ul>
        <li>Search window (single-scale): ±15 px</li>
        <li>Pyramid: scale ×0.5, top-level ±12 px, per-level ±5–7 px</li>
        <li>Feature: Sobel gradient magnitude</li>
        <li>Metric: ZNCC</li>
        <li>Contrast: percentile stretch 1%–99%</li>
        <li>White balance: white-patch + gray-world</li>
        <li>Color mapping: 3×3 fixed matrix (values here)</li>
        <li>Runtime: &lt;1 min per image</li>
        <li>Software: Python, NumPy, OpenCV</li>
      </ul>
    </section>

  </main>

  <footer>
    <p class="muted">© <span id="y"></span> · CS280A · <a href="../index.html">Home</a></p>
  </footer>

  <script>document.getElementById('y').textContent = new Date().getFullYear();</script>
</body>
</html>
